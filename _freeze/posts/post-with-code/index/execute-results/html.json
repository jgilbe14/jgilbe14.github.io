{
  "hash": "301f09799887afc9acc07a34cd261126",
  "result": {
    "markdown": "---\ntitle: \"Litter Decomposition Study using Tidymodels\"\nauthor: \"Josiah Gilbert\"\ndate: \"2022-11-29\"\ncategories: [news, code, analysis]\nimage: fungus.jpg\n---\n\n\n\n\n\nFor this project I utilized some of the tidymodels functionality to run classification models on data from a series of ecological experiments carried out across North America during the 1990's. The experiments studied the chemical/nutritional composition of leaf litter as it decayed over time and in different climate and substrate regimes.\n\nFirst we need to load all of the necessary libraries for our analysis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(data.table)\nlibrary(leaflet)\nlibrary(tidymodels)\nlibrary(kknn)\nlibrary(rpart)\nlibrary(baguette)\nlibrary(ranger)\nlibrary(MASS)\nlibrary(discrim)\nlibrary(rpart.plot)\n```\n:::\n\n\nThe data is stored in a number of different datasets and we need to read all of these in first and then combine them as necessary to be able to explore the data.\n\nI'm using three individual datasets\n\n - taxon_class.csv\n\n - site_data.csv\n \n - nutrients.csv\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntaxa <- fread(\"taxon_class.csv\") %>% \n  dplyr::select(`Taxonomic Code`, `Family`) %>% \n  mutate(\"species\" = as.factor(`Taxonomic Code`),\n         \"family\" = as.factor(Family)) %>% \n  dplyr::select(-c(`Taxonomic Code`, Family))\n\nsite_data <- fread(\"site_data.csv\") %>% \n  dplyr::select(-`STCODE`, `SITENAME`, `LATDEG`, `LATMIN`, `LONGDEG`, `LONGMIN`, `ELEV`, `TEMP`, `PRECIP`) %>% \n  mutate(\"lat\" = LATDEG + LATMIN/60,\n         \"long\" = LONGDEG + LONGMIN/60) %>% \n  dplyr::select(-c(LATDEG, LATMIN, LONGDEG, LONGMIN))\n\nnutrients <- fread(\"nutrients.csv\") %>%\n  mutate(\"species\" = as.factor(SPECIES),\n         \"type\" = as.factor(case_when(TYPE == \"L\" ~ \"leaves\",\n                                      TYPE == \"W\" | TYPE == \"A\" | TYPE == \"B\" ~ \"wood\",\n                                      TYPE == \"R\" ~ \"roots\",\n                                      TYPE == \"M\" ~ \"soil\")),\n         \"site\" = as.factor(SITE),\n         \"K\" = as.numeric(K)) %>% \n  dplyr::select(-c(STCODE, SPECIES, SITE, TYPE, FORMAT, REP, NIR_NUM, STARTDATE, LAB, S, V22, N, AL)) %>%\n  left_join(taxa, by = c(\"species\")) %>% \n  filter(family != \"\") %>% \n  drop_na()\n```\n:::\n\n\nWe can map the locations of the experiment sites using the leaflet package.\n\n::: {.cell}\n\n```{.r .cell-code}\nleaflet() %>%\n      addTiles() %>%\n      addAwesomeMarkers(lng = -site_data$long, lat = site_data$lat,\n                        label = site_data$SITENAME, clusterOptions = markerClusterOptions(freezeAtZoom = 16)) %>%\n      addMiniMap(position = \"bottomleft\", width = 75, height = 75) %>%\n      addProviderTiles(\"Esri.WorldImagery\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-f4dca5dd0908026e997d\" style=\"width:100%;height:464px;\" class=\"leaflet html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-f4dca5dd0908026e997d\">{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"calls\":[{\"method\":\"addTiles\",\"args\":[\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",null,null,{\"minZoom\":0,\"maxZoom\":18,\"tileSize\":256,\"subdomains\":\"abc\",\"errorTileUrl\":\"\",\"tms\":false,\"noWrap\":false,\"zoomOffset\":0,\"zoomReverse\":false,\"opacity\":1,\"zIndex\":1,\"detectRetina\":false,\"attribution\":\"&copy; <a href=\\\"https://openstreetmap.org\\\">OpenStreetMap<\\/a> contributors, <a href=\\\"https://creativecommons.org/licenses/by-sa/2.0/\\\">CC-BY-SA<\\/a>\"}]},{\"method\":\"addAwesomeMarkers\",\"args\":[[44.2333333333333,68.6333333333333,9.16666666666667,64.75,38.8666666666667,45.4,40.8166666666667,35,17.95,43.9333333333333,42.6666666666667,32.5,58,42.4,39.0833333333333,10,18.3166666666667,40.2833333333333,10.3,33.5,46,40.05,47.8333333333333,34.4833333333333,33.5,29.75,37.5],[-122.183333333333,-149.566666666667,-79.85,-148,-105.633333333333,-93.2,-104.766666666667,-83.5,-65.8666666666667,-71.75,-72.25,-106.75,-134,-85.4,-96.5833333333333,-83,-65.8166666666667,-105.65,-84.8,-79.2166666666667,-89.6666666666667,-105.616666666667,-123.883333333333,-106.666666666667,-117.75,-82.5,-75.6666666666667],null,null,null,{\"interactive\":true,\"draggable\":false,\"keyboard\":true,\"title\":\"\",\"alt\":\"\",\"zIndexOffset\":0,\"opacity\":1,\"riseOnHover\":false,\"riseOffset\":250},null,null,{\"showCoverageOnHover\":true,\"zoomToBoundsOnClick\":true,\"spiderfyOnMaxZoom\":true,\"removeOutsideVisibleBounds\":true,\"spiderLegPolylineOptions\":{\"weight\":1.5,\"color\":\"#222\",\"opacity\":0.5},\"freezeAtZoom\":16},null,[\"H.J. Andrews Experimental Forest (AND)\",\"Arctic Tundra (ARC)\",\"Barro Colorado Island (BCI)\",\"Bonanza Creek Experimental Forest (BNZ)\",\"Blodgett Research Forest (BSF)\",\"Cedar Creek Natural History Area (CDR)\",\"Central Plains Experimental Range (CPR)\",\"Coweeta Hydrological Laboratory (CWT)\",\"Guanica State Forest (GSF)\",\"Hubbard Brook Experimental Forest (HBR)\",\"Harvard Forest (HFR)\",\"Jornada Experimental Range (JRN)\",\"Juneau (JUN)\",\"Kellogg Biological Station (KBS)\",\"Konza Prairie Research Natural Area (KNZ)\",\"La Selva Biological Station (LBS)\",\"Luquillo Experimental Forest (LUQ)\",\"Loch Vale Watershed (LVW)\",\"Monte Verde (MTV)\",\"North Inlet (Hobcaw Barony) (NIN)\",\"North Temperate Lakes (NLK)\",\"Niwot Ridge/Green Lakes Valley (NWT)\",\"Olympic National Park (OLY)\",\"Sevilleta National Wildlife Refuge (SEV)\",\"Santa Margarita Ecological Reserve (SMR)\",\"University of Florida (UFL)\",\"Virginia Coast Reserve (VCR)\"],{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]},{\"method\":\"addMiniMap\",\"args\":[null,null,\"bottomleft\",75,75,19,19,-5,false,false,false,false,false,false,{\"color\":\"#ff7800\",\"weight\":1,\"clickable\":false},{\"color\":\"#000000\",\"weight\":1,\"clickable\":false,\"opacity\":0,\"fillOpacity\":0},{\"hideText\":\"Hide MiniMap\",\"showText\":\"Show MiniMap\"},[]]},{\"method\":\"addProviderTiles\",\"args\":[\"Esri.WorldImagery\",null,null,{\"errorTileUrl\":\"\",\"noWrap\":false,\"detectRetina\":false}]}],\"limits\":{\"lat\":[9.16666666666667,68.6333333333333],\"lng\":[-149.566666666667,-65.8166666666667]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\nNote that all of North America is included (extending towards the pole in Alaska) with additional sites in the Caribbean and Central America.\n\nI'm interested in exploring the relationship between the taxonomic family the leaf litter was sourced from and it's nutritional composition. However, since there are 18 different families represented in our cleaned data some with only a few observation, I'm going to focus on the top five familes with the most observations in our dataset. We'll determine which those familes are in the code below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlength(unique(nutrients$family))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 18\n```\n:::\n\n```{.r .cell-code}\ntop_fams <- nutrients %>% \n  group_by(family) %>% \n  summarize(n())%>% \n  top_n(5) %>% \n  pull(family) %>% \n  as.character() %>% \n  as.factor()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nSelecting by n()\n```\n:::\n:::\n\n# Plotting\n\nNow that we have the top five familes in our dataset, let's examaine how the chemical composition of each varies across the different elements. Each of the elements which was analysed in the leaf litter is listed by it's chemical abbreviation. We can look up the meaning of each of these abbreviations.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnutrients %>% \n  filter(family %in% top_fams) %>% \n  ggplot() + \n  geom_boxplot(aes(x = family, y = FE))+\n  theme_classic()+\n  xlab(\"Family\")+\n  ylab(\"Iron\")+\n  ggtitle(\"Iron composition of leaf litter by family\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\nnutrients %>% \n  filter(family %in% top_fams) %>% \n  ggplot() + \n  geom_boxplot(aes(x = family, y = CA))+\n  theme_classic()+\n  xlab(\"Family\")+\n  ylab(\"Calcium\")+\n  ggtitle(\"Calcium composition of leaf litter by family\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-2.png){width=672}\n:::\n\n```{.r .cell-code}\nnutrients %>% \n  filter(family %in% top_fams) %>% \n  ggplot() + \n  geom_boxplot(aes(x = family, y = B))+\n  theme_classic()+\n  xlab(\"Family\")+\n  ylab(\"Boron\")+\n  ggtitle(\"Boron composition of leaf litter by family\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-3.png){width=672}\n:::\n\n```{.r .cell-code}\nnutrients %>% \n  filter(family %in% top_fams) %>% \n  ggplot() + \n  geom_boxplot(aes(x = family, y = CU))+\n  theme_classic()+\n  xlab(\"Family\")+\n  ylab(\"Copper\")+\n  ggtitle(\"Copper composition of leaf litter by family\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-4.png){width=672}\n:::\n\n```{.r .cell-code}\nnutrients %>% \n  filter(family %in% top_fams) %>% \n  ggplot() + \n  geom_boxplot(aes(x = family, y = K))+\n  theme_classic()+\n  xlab(\"Family\")+\n  ylab(\"Potassium\")+\n  ggtitle(\"Potassium composition of leaf litter by family\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-5.png){width=672}\n:::\n\n```{.r .cell-code}\nnutrients %>% \n  filter(family %in% top_fams) %>% \n  ggplot() + \n  geom_boxplot(aes(x = family, y = MG))+\n  theme_classic()+\n  xlab(\"Family\")+\n  ylab(\"Magnesium\")+\n  ggtitle(\"Magnesium composition of leaf litter by family\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-6.png){width=672}\n:::\n\n```{.r .cell-code}\nnutrients %>% \n  filter(family %in% top_fams) %>% \n  ggplot() + \n  geom_boxplot(aes(x = family, y = MN))+\n  theme_classic()+\n  xlab(\"Family\")+\n  ylab(\"Manganese\")+\n  ggtitle(\"Manganese composition of leaf litter by family\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-7.png){width=672}\n:::\n\n```{.r .cell-code}\nnutrients %>% \n  filter(family %in% top_fams) %>% \n  ggplot() + \n  geom_boxplot(aes(x = family, y = P))+\n  theme_classic()+\n  xlab(\"Family\")+\n  ylab(\"Phosphorus\")+\n  ggtitle(\"Phosphorus\n composition of leaf litter by family\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-8.png){width=672}\n:::\n\n```{.r .cell-code}\nnutrients %>% \n  filter(family %in% top_fams) %>% \n  ggplot() + \n  geom_boxplot(aes(x = family, y = ZN))+\n  theme_classic()+\n  xlab(\"Family\")+\n  ylab(\"Zinc\")+\n  ggtitle(\"Zinc\n composition of leaf litter by family\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-9.png){width=672}\n:::\n:::\n\n\nExamaining the plots a few observations strike me. First, note how strongly right-skewed the distribution of chemical composition within each family is for most of the chemicals. Almost all of the boxplots feature long right tails of outliers. Second notice that some of the chemicals seem to have different concentrations depending on family. Looking at the plot for calcium, note how Euphorbiaceae (the spurge family) has a mean that is substantially higher (arguably) than the means for any of the other familes except Pinaceae. A similar observation can be made about the Manganese composition in the Aceraceae (maple family) which appears to have a substantially higher mean manganese composition than any of the other familes. Suffice it to say, there appears to be differentiation in leaf litter composition based on the source family. Let's try building some classification models to see if we can take advantage of this differentiation to predict the source family of a given sample of leaf litter based on it's chemical composition.\n\n# Classification Models using tidymodels\n\nWe are going to try to predict the family which the leaf litter came from based on the chemical composition of the leaf litter. To do this I'm going to use tidymodels, which has a stream-lined pipeline approach to fitting models which will allow us to test several different kinds of classification models.\n\n## K-nearest Neighbors\n\nWe'll using the classic K-nearest neighbors model. To fit a model in the tidyverse we specify the \"recipe\" which in our simple case is just the response and predictors and the data source. We then specify the model, including the engine (the package for the model) and the mode (classification in our case). We are interested in predicative accuracy, so we'll use cross-validation to estimate the out-of-sample predicative accuracy.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(452)\n\ntop_fam_nutrients <- nutrients %>%\n  filter(family %in% top_fams) %>%\n  mutate(\"family\" = as.character(family))\n\nfamily_recipe <- recipe(family ~ B + CA + CU + FE + K + MG + MN + P + ZN, data = top_fam_nutrients)\n\nknn_mod <- nearest_neighbor() %>%\n  set_engine(\"kknn\") %>%\n  set_mode(\"classification\")\n\nfamily_workflow_knn <- workflow() %>% \n  add_recipe(family_recipe) %>% \n  add_model(knn_mod)\n\nfamily_cvs <- vfold_cv(top_fam_nutrients, v = 10)\n\nfamily_workflow_knn %>% fit_resamples(family_cvs) %>% collect_metrics()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 x 6\n  .metric  .estimator  mean     n std_err .config             \n  <chr>    <chr>      <dbl> <int>   <dbl> <chr>               \n1 accuracy multiclass 0.689    10  0.0110 Preprocessor1_Model1\n2 roc_auc  hand_till  0.860    10  0.0119 Preprocessor1_Model1\n```\n:::\n:::\n\n\nOur k-nearest neighbor's model was able to successfully predict which of the five top families a given leaf litter sample came from about 69% of the time. Not terrible accuracy for a multiclass problem (as opposed to a binary classification problem), but still not very good. Let's see if we can do better with some other kind of model.\n\n## Trees\n### Decision Trees\nWe'll try a decision tree next. The process is very similar, and since we already specified a recipe when fitting our k-nearest neighbors model we'll just reuse that recipe here. Again, we'll cross-validate to find our estimated out-of-sample predictive accuracy.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(214)\n\ndt_mod <- decision_tree() %>% \n  set_engine(\"rpart\") %>% \n  set_mode(\"classification\")\n\nfamily_workflow_dt <- workflow() %>% \n  add_recipe(family_recipe) %>% \n  add_model(dt_mod)\n\nfamily_workflow_dt %>% fit_resamples(family_cvs) %>% collect_metrics()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 x 6\n  .metric  .estimator  mean     n std_err .config             \n  <chr>    <chr>      <dbl> <int>   <dbl> <chr>               \n1 accuracy multiclass 0.622    10  0.0152 Preprocessor1_Model1\n2 roc_auc  hand_till  0.799    10  0.0106 Preprocessor1_Model1\n```\n:::\n:::\n\n\nOur decision tree actually fared worse than the k-nearest neighbor's model, with an estimated predictive accuracy of about 62%.\n\nWe can also plot our decision tree, which can show us which are the most important variables in classifying the family of the sample.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfitted_family_tree <- fit(family_workflow_dt, data = top_fam_nutrients) %>% extract_fit_parsnip()\n\nrpart.plot(fitted_family_tree$fit, roundint = FALSE)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n### Bagged Trees\n\nNow let's try a bagged tree. This bootstraps our data and then builds many different treees based on those different bootstraped samples and uses the overall prediction from all the trees to classify the data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(615)\n\nbag_tree_mod <- bag_tree() %>% \n  set_engine(\"rpart\") %>% \n  set_mode(\"classification\")\n\nfamily_workflow_bgt <- workflow() %>% \n  add_recipe(family_recipe) %>% \n  add_model(bag_tree_mod)\n\nfamily_workflow_bgt %>% fit_resamples(family_cvs) %>% collect_metrics()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 x 6\n  .metric  .estimator  mean     n std_err .config             \n  <chr>    <chr>      <dbl> <int>   <dbl> <chr>               \n1 accuracy multiclass 0.732    10 0.00887 Preprocessor1_Model1\n2 roc_auc  hand_till  0.899    10 0.00967 Preprocessor1_Model1\n```\n:::\n:::\n\n\nWe see improvement over the decision tree and even our k-nearest neighbor's model, with an estimated out-of-sample predicative accuracy of 73%.\n\n### Random Forest\n\nLet's try a random forest next. A random forest also is built using bootstrapped samples from the orginal sample, like a bagged tree, but it builds different trees using different subsets of the possible predictors.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(943)\n\nrf_mod <- rand_forest() %>% \n  set_engine(\"ranger\") %>% \n  set_mode(\"classification\")\n\nfamily_workflow_rf <- workflow() %>% \n  add_recipe(family_recipe) %>% \n  add_model(rf_mod)\n\nfamily_workflow_rf %>% fit_resamples(family_cvs) %>% collect_metrics()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 x 6\n  .metric  .estimator  mean     n std_err .config             \n  <chr>    <chr>      <dbl> <int>   <dbl> <chr>               \n1 accuracy multiclass 0.775    10 0.00850 Preprocessor1_Model1\n2 roc_auc  hand_till  0.928    10 0.00728 Preprocessor1_Model1\n```\n:::\n:::\n\n\nOur random forest model has the best predictive accuracy of any of the models we've tested so far with an estimated out-of-sample predicative accuracy of 77.5%.\n\nTwo final methods we can try are Linear Discriminant Analysis and Quadratic Discriminant Analysis.\n\n### Linear Discriminant Analysis\n\nI'm less familiar with how either LDA or QDA works so I'll simply report the results.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(121)\n\nlda_mod <- discrim_linear() %>%\n  set_engine(\"MASS\") %>%\n  set_mode(\"classification\")\n\nfamily_workflow_lda <- workflow() %>% \n  add_recipe(family_recipe) %>% \n  add_model(lda_mod)\n\nfamily_workflow_lda %>% fit_resamples(family_cvs) %>% collect_metrics()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 x 6\n  .metric  .estimator  mean     n std_err .config             \n  <chr>    <chr>      <dbl> <int>   <dbl> <chr>               \n1 accuracy multiclass 0.506    10  0.0177 Preprocessor1_Model1\n2 roc_auc  hand_till  0.774    10  0.0110 Preprocessor1_Model1\n```\n:::\n:::\n\n\nOur worst model so far, our LDA model has an estimated out-of-sample predicative accuracy of just over 50%.\n\n### Quadratic Discriminant Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(333)\n\nqda_mod <- discrim_quad() %>% \n             set_engine('MASS') %>% \n             set_mode('classification')\n\nfamily_workflow_qda <- workflow() %>% \n  add_recipe(family_recipe) %>% \n  add_model(qda_mod)\n\nfamily_workflow_qda %>% fit_resamples(family_cvs) %>% collect_metrics()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 x 6\n  .metric  .estimator  mean     n std_err .config             \n  <chr>    <chr>      <dbl> <int>   <dbl> <chr>               \n1 accuracy multiclass 0.452    10  0.0141 Preprocessor1_Model1\n2 roc_auc  hand_till  0.729    10  0.0136 Preprocessor1_Model1\n```\n:::\n:::\n\n\nRemarkably exceeding the LDA in lack of accuracy, our LDA model has an estimated out-of-sample predicative accuracy of 45%.\n\n# Possible confounding\n\nNot knowing the exact experimental design, I want to check whether all families were tested at all sites, or whether perhaps families were tested primarily at the sites where the are native. I was not able to determine whether the leaf litter being studied was the natural leaf litter at each site or whether the leaf litter from each site was tested at all of the other sites. While I don't have information on the native range for all of the species in the study, we can check whether the top families were tested at all of the sites or not.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntop_fam_nutrients %>%\n  group_by(family) %>% \n  summarize(length(unique(site)))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 x 2\n  family        `length(unique(site))`\n  <chr>                          <int>\n1 Aceraceae                         28\n2 Cupressaceae                      28\n3 Euphorbiaceae                     28\n4 Pinaceae                          28\n5 Poaceae                           28\n```\n:::\n\n```{.r .cell-code}\nmissing_site <- as.character(unique(nutrients$site)[!(unique(nutrients$site) %in% unique(top_fam_nutrients$site))][1])\n\nsite_data %>% \n  filter(SITE == missing_site) %>% \n  pull(SITENAME)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\ncharacter(0)\n```\n:::\n:::\n\n\nThis is an unexpected result... it appears that the site metadata file does not contain an entry for the site which did not have any of the top five families. I investigated this a bit more and concluded that it was legitimate site, but could not determine why it is missing from the metadata file.\n\nAnother way to approach this same question is to examine a species that I am familiar with and see whether it was tested at experimental sites outside of it's natural range. I'll choose Pseudotsuga menziesii, the Douglas Fir, a coniferous tree found in western North America. Let's see which sites tested Douglas Fir litter, if any of those sites were outside of the native range of Douglas Fir we can conclude that the experimental design included testing litter outside of it's source site.\n\nFirst we need to determine the species code of Douglas Fir\n\n::: {.cell}\n\n```{.r .cell-code}\ntaxa_species <- fread(\"taxon_class.csv\") %>% \n  dplyr::select(`Taxonomic Code`, \"Species\") %>% \n  filter(Species == \"Pseudotsuga menziesii\") %>% \n  dplyr::select(-Species) %>% \n  mutate(\"species\" = as.factor(`Taxonomic Code`)) %>% \n  pull(species) %>% \n  as.character()\n\ntaxa_species\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"PSME\"\n```\n:::\n:::\n\n\nNow we can see which sites had Douglas Fir litter tested at them. We'll map them.\n\n::: {.cell}\n\n```{.r .cell-code}\ndouglas_fir_site_names <- nutrients %>% \n  filter(species == taxa_species) %>% \n  group_by(site) %>% \n  summarize(n()) %>% \n  pull(site) %>% \n  as.character()\n\ndouglas_fir_sites <- site_data %>% \n  filter(SITE %in% douglas_fir_site_names)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nleaflet() %>%\n      addTiles() %>%\n      addAwesomeMarkers(lng = -douglas_fir_sites$long, lat = douglas_fir_sites$lat,\n                        label = douglas_fir_sites$SITENAME, clusterOptions = markerClusterOptions(freezeAtZoom = 16)) %>%\n      addMiniMap(position = \"bottomleft\", width = 75, height = 75) %>%\n      addProviderTiles(\"Esri.WorldImagery\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-ca7d8373c6c6df604d3c\" style=\"width:100%;height:464px;\" class=\"leaflet html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-ca7d8373c6c6df604d3c\">{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"calls\":[{\"method\":\"addTiles\",\"args\":[\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",null,null,{\"minZoom\":0,\"maxZoom\":18,\"tileSize\":256,\"subdomains\":\"abc\",\"errorTileUrl\":\"\",\"tms\":false,\"noWrap\":false,\"zoomOffset\":0,\"zoomReverse\":false,\"opacity\":1,\"zIndex\":1,\"detectRetina\":false,\"attribution\":\"&copy; <a href=\\\"https://openstreetmap.org\\\">OpenStreetMap<\\/a> contributors, <a href=\\\"https://creativecommons.org/licenses/by-sa/2.0/\\\">CC-BY-SA<\\/a>\"}]},{\"method\":\"addAwesomeMarkers\",\"args\":[[33.5,37.5],[-79.2166666666667,-75.6666666666667],null,null,null,{\"interactive\":true,\"draggable\":false,\"keyboard\":true,\"title\":\"\",\"alt\":\"\",\"zIndexOffset\":0,\"opacity\":1,\"riseOnHover\":false,\"riseOffset\":250},null,null,{\"showCoverageOnHover\":true,\"zoomToBoundsOnClick\":true,\"spiderfyOnMaxZoom\":true,\"removeOutsideVisibleBounds\":true,\"spiderLegPolylineOptions\":{\"weight\":1.5,\"color\":\"#222\",\"opacity\":0.5},\"freezeAtZoom\":16},null,[\"North Inlet (Hobcaw Barony) (NIN)\",\"Virginia Coast Reserve (VCR)\"],{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]},{\"method\":\"addMiniMap\",\"args\":[null,null,\"bottomleft\",75,75,19,19,-5,false,false,false,false,false,false,{\"color\":\"#ff7800\",\"weight\":1,\"clickable\":false},{\"color\":\"#000000\",\"weight\":1,\"clickable\":false,\"opacity\":0,\"fillOpacity\":0},{\"hideText\":\"Hide MiniMap\",\"showText\":\"Show MiniMap\"},[]]},{\"method\":\"addProviderTiles\",\"args\":[\"Esri.WorldImagery\",null,null,{\"errorTileUrl\":\"\",\"noWrap\":false,\"detectRetina\":false}]}],\"limits\":{\"lat\":[33.5,37.5],\"lng\":[-79.2166666666667,-75.6666666666667]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\nThe results are quite surprising. Douglas Fir was not tested at all of the sites, but only at a few sites on the Atlantic Coast. Douglas Fir is not native to the Atlantic Coast, so I do not have an explanation for why these are the sites where it was tested.\n\n# Conclusion\n\nAs we've seen, tidymodels provides an easy and streamlined method to fit machine-learning models in R. In fact, we've barely scratched the surface since we didn't consider tuning any of the parameters of our models using a grid search, or adding steps to our recipes to choose two possible complexities we could have added to our analysis.\n\nAnd with regard to the data, there is so much more we could have explored. I did not take into consideration how long the leaf litter had been decaying (although this was part of the experiment), and I think that delving deeper in the experimental design and determining exactly how the study was setup and conducted would help us think about the questions I raised toward the end as to whether the observations for each plant were taken at all sites or at a small subset (which seems like it would be a confounding factor).\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/htmlwidgets-1.5.4/htmlwidgets.js\"></script>\r\n<script src=\"../../site_libs/jquery-1.12.4/jquery.min.js\"></script>\r\n<link href=\"../../site_libs/leaflet-1.3.1/leaflet.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/leaflet-1.3.1/leaflet.js\"></script>\r\n<link href=\"../../site_libs/leafletfix-1.0.0/leafletfix.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/proj4-2.6.2/proj4.min.js\"></script>\r\n<script src=\"../../site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js\"></script>\r\n<link href=\"../../site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/leaflet-binding-2.1.1/leaflet.js\"></script>\r\n<link href=\"../../site_libs/leaflet-awesomemarkers-2.0.3/leaflet.awesome-markers.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/leaflet-awesomemarkers-2.0.3/leaflet.awesome-markers.min.js\"></script>\r\n<link href=\"../../site_libs/leaflet-markercluster-1.0.5/MarkerCluster.css\" rel=\"stylesheet\" />\r\n<link href=\"../../site_libs/leaflet-markercluster-1.0.5/MarkerCluster.Default.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/leaflet-markercluster-1.0.5/leaflet.markercluster.js\"></script>\r\n<script src=\"../../site_libs/leaflet-markercluster-1.0.5/leaflet.markercluster.freezable.js\"></script>\r\n<script src=\"../../site_libs/leaflet-markercluster-1.0.5/leaflet.markercluster.layersupport.js\"></script>\r\n<link href=\"../../site_libs/leaflet-minimap-3.3.1/Control.MiniMap.min.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/leaflet-minimap-3.3.1/Control.MiniMap.min.js\"></script>\r\n<script src=\"../../site_libs/leaflet-minimap-3.3.1/Minimap-binding.js\"></script>\r\n<script src=\"../../site_libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js\"></script>\r\n<script src=\"../../site_libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}